generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(cuid())
  email        String         @unique(map: "email")
  password     String?
  role         users_role     @default(CUSTOMER)
  createdAt    DateTime       @default(now())
  provider     users_provider @default(LOCAL)
  providerId   String?        @unique
  refreshToken String?
  updatedAt    DateTime       @updatedAt
  profile      profiles?
  orders       Order[]

  @@map("users")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  description String?
  basePrice   Float
  createdAt   DateTime @default(now())
  isActive    Boolean  @default(true)
  updatedAt   DateTime @updatedAt

  @@map("products")
}

model Order {
  id             String        @id @default(cuid())
  status         orders_status @default(CREATED)
  createdAt      DateTime      @default(now())
  idempotencyKey String        @unique
  subtotal       Decimal       @db.Decimal(10, 2)
  total          Decimal       @db.Decimal(10, 2)
  updatedAt      DateTime      @updatedAt
  userId         String
  user           User          @relation(fields: [userId], references: [id])
  items          OrderItem[]

  @@map("orders")
}

model OrderItem {
  id            String  @id @default(cuid())
  quantity      Int
  basePrice     Decimal @db.Decimal(10, 2)
  itemPrice     Decimal @db.Decimal(10, 2)
  lineTotal     Decimal @db.Decimal(10, 2)
  materialId    String
  materialName  String
  materialPrice Decimal @db.Decimal(10, 2)
  orderId       String
  productId     String
  productName   String
  order         Order   @relation(fields: [orderId], references: [id])

  @@map("order_items")
}

model addresses {
  id         String   @id @default(cuid())
  userId     String
  line1      String
  line2      String?
  city       String
  state      String
  postalCode String
  country    String
  isDefault  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model audit_logs {
  id        String           @id @default(cuid())
  actorId   String?
  role      audit_logs_role?
  action    String
  entity    String
  entityId  String?
  ip        String?
  metadata  Json?
  createdAt DateTime         @default(now())

  @@index([action])
  @@index([actorId])
  @@index([createdAt])
  @@index([entity])
}

model cart_items {
  id         String   @id @default(cuid())
  cartId     String
  productId  String
  materialId String
  quantity   Int      @default(1)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([cartId, productId, materialId])
}

model carts {
  id        String   @id @default(cuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model file_access_logs {
  id         String   @id @default(cuid())
  userId     String
  orderId    String
  fileId     String
  ipAddress  String?
  accessedAt DateTime @default(now())
}

model invoices {
  id            String   @id @default(cuid())
  orderId       String   @unique
  invoiceNumber String   @unique
  invoiceUrl    String
  issuedAt      DateTime @default(now())
}

model materials {
  id        String   @id @default(cuid())
  productId String
  name      String
  price     Float
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model order_addresses {
  id         String  @id @default(cuid())
  orderId    String  @unique
  fullName   String
  phone      String
  line1      String
  line2      String?
  city       String
  state      String
  postalCode String
  country    String
}

model password_reset_tokens {
  id        String    @id @default(cuid())
  userId    String
  token     String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  @@index([expiresAt])
  @@index([userId])
}

model payments {
  id                String           @id @default(cuid())
  orderId           String           @unique
  userId            String
  gateway           payments_gateway @default(RAZORPAY)
  amount            Decimal          @db.Decimal(10, 2)
  currency          String           @default("INR")
  razorpayOrderId   String?          @unique
  razorpayPaymentId String?
  razorpaySignature String?
  status            payments_status  @default(CREATED)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
}

model product_models {
  id        String   @id @default(cuid())
  productId String
  fileName  String
  fileUrl   String
  fileType  String
  fileSize  Int
  createdAt DateTime @default(now())
}

model profiles {
  id        String   @id @default(cuid())
  userId    String   @unique
  fullName  String?
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model shipments {
  id             String           @id @default(cuid())
  orderId        String           @unique
  courierName    String
  trackingNumber String           @unique
  status         shipments_status @default(PENDING)
  shippedAt      DateTime?
  deliveredAt    DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
}

enum orders_status {
  CREATED
  PAYMENT_PENDING
  PAYMENT_FAILED
  PAID
  CANCELLED
}

enum audit_logs_role {
  ADMIN
  CUSTOMER
}

enum payments_gateway {
  RAZORPAY
}

enum users_role {
  ADMIN
  CUSTOMER
}

enum shipments_status {
  PENDING
  SHIPPED
  IN_TRANSIT
  DELIVERED
}

enum users_provider {
  LOCAL
  GOOGLE
  MICROSOFT
}

enum payments_status {
  CREATED
  INITIATED
  AUTHORIZED
  CAPTURED
  FAILED
  REFUNDED
}
